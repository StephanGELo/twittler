<!DOCTYPE html>
<html>
  <head>
    <title>myTwittler</title> 
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="jquery.timeago.js"></script>
    <link href="geloStyleSheet.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div class="body">
      <h1>Twittler</h1>
    </div>
    <script>
      
      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        var $input = $('<input type="text" placeholder="twittle here..:p"></input>');
        $input.appendTo($body);
         
        var $refreshTweets = $('<a href="#" class="refreshTweets"></a>');
        $refreshTweets.text('New Twittles');
        $refreshTweets.prependTo($body);
         
        var $div = $('<div></div>');
        $div.appendTo($body);

        var displayNewTweets = function(user) {
         
          if (user) {
            var index = streams.home.length - 1;
          } else {
            var index = streams.users[user].length - 1;
          }

          while(index >= 0) {
            var tweet = streams.home[index];
            var $tweet = $('<div></div');
            $tweet.addClass('tweet');

            //adding users to html
            var $user = $('<a></a>');
            $user.attr({'href':'#', 'data-user': tweet.user, 'class': 'userName'});
            $user.text('@' + tweet.user);
            $user.appendTo($tweet);
            
            //adding messages
            $tweet.append(': ' + tweet.message);
            
            // adding timestamps
            var $tweetTime = $('<span></span>');
            $tweetTime.addClass('timestamps');
            var humanFriendlyTime = jQuery.timeago(tweet.created_at);//use of jquery pluggin
            $tweetTime.text(humanFriendlyTime);
            $tweetTime.appendTo($tweet);

            $tweet.appendTo($div);
            index -= 1; 
          }

          // click on username to display timeline
          $('.userName').on('click', function (event) {
            event.preventDefault();
            displayNewTweets($(this).data('user')); // not working properly
          });
        };

        displayNewTweets(true);

        // click on New Twittles to display new messages
        $('.refreshTweets').on('click', function(event){
          event.preventDefault();
          displayNewTweets(true);
        });  
         
         // allowing user to twittle  // need to debug
        $('.input').keypress(function (event){
          if(event.which === 15) {
            window.visitor = 'newUser';
            if(!streams.users[window.visitor]) {
              streams.users[window.visitor] = [];
            }

            writeTweet($(this).val());
            $(this).val('');
            displayNewTweets(true);
          }
        });
      });

    </script>
  </body>
</html>


<!-- var index = streams.home.length - 1;
          while(index >= 0) {
            var tweet = streams.home[index];
             var $tweet = $(
              '<div class="userTweet row span5">' +
                '<div class="row">' +
                  '<div class="userName span2"><a href="#" class =' +
                    tweet.user + '>' + '@' + tweet.user + ' posted:' +
                  '</a></div>' +
                '</div>' + 
                '<div class="row">' +
                  '<p class="span5">' +
                    tweet.message +
                  '</p>' +
                '</div>' +
                '<div class="timestamps span6 text-left">' + tweet.created_at+ 
                 '</div>' +
              '</div>');
            //$tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.appendTo($body);
            index -= 1;   
          } -->